# üìä Metrics Cardinality: The Silent Performance Killer

In monitoring systems like Prometheus or Datadog, **Cardinality** refers to the number of unique time-series combinations generated by your metrics and their labels (tags). High cardinality is one of the most common reasons for monitoring system failures and massive cloud bills.

> [!IMPORTANT]
> **Staff Engineer Insight:** "Labels are powerful, but they are not free. Adding a `user_id` as a label to a metric might seem like a good idea for debugging, but if you have 1 million users, you just created 1 million unique time-series. As a Staff Engineer, you must keep cardinality low by using 'High-Cardinality' data in Logs/Traces, and 'Low-Cardinality' data in Metrics."

---

## üèóÔ∏è 1. What is Cardinality?

Cardinality is calculated by multiplying the number of unique values of each label.

**Example:**
* Metric Name: `http_requests_total`
* Label `method`: [GET, POST, PUT] (3 values)
* Label `status`: [200, 404, 500] (3 values)
* Label `region`: [US-East, EU-West] (2 values)

**Total Time-Series:** $3 \times 3 \times 2 = 18$ combinations. This is **Low Cardinality** (Safe).

---

## üõë 2. The Danger of High Cardinality

If you add a label like `user_id` or `order_id`:
* Label `user_id`: [1,000,000 unique users]
* **Total Time-Series:** $1,000,000 \times 18 = 18,000,000$ combinations!



### Why is this bad?
1. **Memory Usage:** Prometheus stores these in RAM. 18M series can easily crash a server.
2. **Query Performance:** Searching through millions of series to draw a simple graph becomes extremely slow.
3. **Storage Costs:** Cloud providers charge per "Custom Metric" or "Indexed Series."

---

## üõ†Ô∏è 3. Best Practices to Control Cardinality

1.  **Never use unique IDs as labels:** Avoid `user_id`, `email`, `request_id`, or `order_id`.
2.  **Use Buckets Wisely:** In Histograms (e.g., latency), don't create 100 buckets. Use 10-15 meaningful ones.
3.  **Use Logs for Detail:** If you need to know which specific user got an error, look at the **Logs** or **Traces**, not the metrics.
4.  **Aggregation:** Aggregate high-cardinality data before sending it to the monitoring tool (e.g., instead of tracking every URL, track `/api/v1/users/*`).

---

## üìä Summary: Metrics vs. Logs vs. Traces

| Feature | Metrics | Logs | Traces |
| :--- | :--- | :--- | :--- |
| **Cardinality** | Must be **Low** | Can be **High** | High (per request) |
| **Cost** | High per series | High per GB | High per Span |
| **Goal** | Alerting & Trends | Root Cause Analysis | Latency Analysis |
